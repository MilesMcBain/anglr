<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Simple features and the R spatial zoo. rangl</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container">
      <header><div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rangl</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Simple features and the R spatial zoo</h1>
                        <h4 class="author">Michael Sumner</h4>
            
            <h4 class="date">2016-11-09</h4>
          </div>

    
    
<div id="base-graphics" class="section level2">
<h2>Base graphics</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.75</span>, <span class="dv">1</span>,   <span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.69</span>, <span class="dv">0</span>), 
           <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,    <span class="fl">0.8</span>, <span class="fl">0.7</span>, <span class="fl">0.6</span>, <span class="dv">0</span>,    <span class="dv">0</span>))
p2 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>), 
            <span class="dt">y =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>))
p4 &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">0.69</span>, <span class="fl">0.8</span>, <span class="fl">1.1</span>, <span class="fl">1.23</span>, <span class="fl">0.69</span>), 
            <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.6</span>, <span class="fl">0.63</span>, <span class="fl">0.3</span>, <span class="dv">0</span>))
pp &lt;-<span class="st"> </span><span class="kw">rbind</span>(p1, <span class="ot">NA</span>,  p2[<span class="kw">nrow</span>(p2):<span class="dv">1</span>, ])
<span class="kw"><a href="../reference/plot-rangl.html">plot</a></span>(<span class="kw">rbind</span>(pp, p4), <span class="dt">cex =</span> <span class="fl">1.3</span>, <span class="dt">main =</span> <span class="st">"two polygons, shared edge"</span>)
<span class="kw">polypath</span>(pp, <span class="dt">col =</span> <span class="st">"grey"</span>)
<span class="kw">polypath</span>(p4, <span class="dt">col =</span> <span class="st">"firebrick"</span>)</code></pre></div>
<p><img src="sf-zoo2_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
</div>
<div id="simple-features-for-r" class="section level2">
<h2>Simple features for R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#devtools::install_github("edzer/sfr")</span>
<span class="kw">library</span>(sf)
<span class="kw">library</span>(tibble)
x &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(<span class="kw">tibble</span>(<span class="dt">a =</span> <span class="dv">1</span>:<span class="dv">2</span>, <span class="dt">geom =</span> <span class="kw">st_sfc</span>(<span class="kw">list</span>(<span class="kw">st_multipolygon</span>(<span class="kw">list</span>(<span class="kw">list</span>(p1, p2[<span class="kw">rev</span>(<span class="kw">seq</span>(<span class="kw">nrow</span>(p2))), ]))),  
                                                 <span class="kw">st_multipolygon</span>(<span class="kw">list</span>(<span class="kw">list</span>(p4)))))))
<span class="kw"><a href="../reference/plot-rangl.html">plot</a></span>(x, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">"grey"</span>, <span class="st">"firebrick"</span>))</code></pre></div>
<p><img src="sf-zoo2_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div id="spatial-legacy-sp-package" class="section level2">
<h2>Spatial (legacy sp package)</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sp)
spgdf &lt;-<span class="st"> </span><span class="kw">as</span>(x, <span class="st">"Spatial"</span>)
<span class="kw"><a href="../reference/plot-rangl.html">plot</a></span>(spgdf, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">"grey"</span>, <span class="st">"firebrick"</span>))</code></pre></div>
<p><img src="sf-zoo2_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
</div>
<div id="grammar-of-graphics" class="section level2">
<h2>Grammar of graphics</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## fortify model
<span class="kw">library</span>(dplyr)
meta &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(x %&gt;%<span class="st"> </span>dplyr::<span class="kw">select</span>(-geom) %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">object_ =</span> <span class="kw">row_number</span>()))
map &lt;-<span class="st"> </span>spbabel::<span class="kw">sptable</span>(spgdf)
<span class="kw">library</span>(ggplot2)
ggcols &lt;-<span class="st"> </span>ggplot2::<span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">"1"</span> =<span class="st"> "grey"</span>, <span class="st">"2"</span>  =<span class="st"> "firebrick"</span>)) 
<span class="kw">ggplot</span>(map %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">rn =</span> <span class="kw">row_number</span>()) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(meta)) +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> x_, <span class="dt">y =</span> y_, <span class="dt">group =</span> branch_, <span class="dt">fill =</span> <span class="kw">factor</span>(object_)) +
<span class="st">  </span>ggcols +<span class="st"> </span>ggpolypath::<span class="kw">geom_polypath</span>() +<span class="st"> </span><span class="kw">geom_path</span>()</code></pre></div>
<pre><code>## Joining, by = "object_"</code></pre>
<p><img src="sf-zoo2_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
</div>
<div id="map-table" class="section level2">
<h2>Map table</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spbabel)
mp &lt;-<span class="st"> </span><span class="kw">map_table</span>(spgdf)
ggcols &lt;-<span class="st"> </span>ggplot2::<span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">setNames</span>(<span class="kw">c</span>(<span class="st">"grey"</span>, <span class="st">"firebrick"</span>), mp$o$object_))
gg &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mp$o %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(mp$b) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(mp$bXv) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(mp$v))</code></pre></div>
<pre><code>## Joining, by = "object_"</code></pre>
<pre><code>## Joining, by = "branch_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gg +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x =</span> x_, <span class="dt">y =</span> y_, <span class="dt">group =</span> branch_, <span class="dt">fill =</span> object_) +<span class="st"> </span>ggcols +<span class="st"> </span>ggpolypath::<span class="kw">geom_polypath</span>() +<span class="st"> </span><span class="kw">geom_path</span>(<span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="sf-zoo2_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div id="planar-straight-line-graph" class="section level2">
<h2>Planar straight line graph</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## purrring function
p2seg &lt;-<span class="st"> </span>function(x) <span class="kw">as_tibble</span>(rangl:::<span class="kw">path2seg</span>(x$vertex_))
BxE &lt;-<span class="st"> </span>mp$bXv %&gt;%<span class="st"> </span><span class="kw">split</span>(.$branch_) %&gt;%<span class="st"> </span>purrr::<span class="kw">map</span>(p2seg) %&gt;%<span class="st"> </span><span class="kw">bind_rows</span>(<span class="dt">.id =</span> <span class="st">"branch_"</span>)
<span class="kw">ggplot</span>(BxE %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(mp$v %&gt;%<span class="st"> </span><span class="kw">rename</span>(<span class="dt">x =</span> x_, <span class="dt">y =</span> y_), <span class="kw">c</span>(<span class="st">"V1"</span> =<span class="st"> "vertex_"</span>)) %&gt;%<span class="st"> </span>
<span class="st">                            </span><span class="kw">inner_join</span>(mp$v, <span class="kw">c</span>(<span class="st">"V2"</span> =<span class="st"> "vertex_"</span>))) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">xend =</span> x_, <span class="dt">yend =</span> y_, <span class="dt">colour =</span> branch_))</code></pre></div>
<p><img src="sf-zoo2_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
<div id="arc-node" class="section level2">
<h2>Arc-node</h2>
<p>These are the nodes in the graph, we need to traverse the edges to determine the arc-branches, and anything left is just a standalone arc. (But it&rsquo;s only the 3-branch nodes, we need a better rule to catch the boundaries with only 2 &hellip; WIP).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## what are the nodes?
x1 &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="kw">system.file</span>(<span class="st">"shape/nc.shp"</span>, <span class="dt">package=</span><span class="st">"sf"</span>), <span class="st">"nc"</span>, <span class="dt">crs =</span> <span class="dv">4267</span>)</code></pre></div>
<pre><code>## Reading layer `nc' from data source `C:/Users/mdsumner/Documents/R/win-library/3.3/sf/shape/nc.shp' using driver `ESRI Shapefile'
## features:       100
## fields:         14
## converted into: MULTIPOLYGON
## proj4string:    +proj=longlat +datum=NAD27 +no_defs</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mp &lt;-<span class="st"> </span>spbabel::<span class="kw">map_table</span>(x1)

nodes &lt;-<span class="st"> </span>mp$v %&gt;%<span class="st"> </span>dplyr::<span class="kw">select</span>(vertex_) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(mp$bXv) %&gt;%<span class="st"> </span><span class="kw">distinct</span>(vertex_, branch_) %&gt;%<span class="st"> </span><span class="kw">group_by</span>(vertex_) %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">nb =</span> <span class="kw">n</span>()) %&gt;%<span class="st">  </span><span class="kw">ungroup</span>() %&gt;%<span class="st"> </span><span class="kw">filter</span>(nb &gt;<span class="st"> </span><span class="dv">2</span>) %&gt;%<span class="st"> </span><span class="kw">distinct</span>(vertex_) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(mp$v)</code></pre></div>
<pre><code>## Joining, by = "vertex_"
## Joining, by = "vertex_"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot-rangl.html">plot</a></span>(x1)
<span class="kw">points</span>(nodes$x_, nodes$y_, <span class="dt">cex =</span> <span class="fl">0.9</span>)</code></pre></div>
<p><img src="sf-zoo2_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div id="simplicial-complex" class="section level2">
<h2>Simplicial complex</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sc &lt;-<span class="st"> </span>rangl::<span class="kw"><a href="../reference/rangl.html">rangl</a></span>(spgdf)
<span class="kw"><a href="../reference/plot-rangl.html">plot</a></span>(x)
l1 &lt;-<span class="st"> </span><span class="kw">inner_join</span>(sc$o[<span class="dv">1</span>, ], sc$t) %&gt;%<span class="st"> </span><span class="kw">split</span>(.$triangle_) %&gt;%<span class="st"> </span>purrr::<span class="kw">map</span>(function(x) <span class="kw">inner_join</span>(x, sc$tXv) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(sc$v)) </code></pre></div>
<pre><code>## Joining, by = "object_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">j &lt;-<span class="st"> </span><span class="kw">lapply</span>(l1, function(x) <span class="kw">polygon</span>(<span class="kw">cbind</span>(x$x_, x$y_), <span class="dt">col =</span> <span class="st">"grey"</span>))
l2 &lt;-<span class="st"> </span><span class="kw">inner_join</span>(sc$o[<span class="dv">2</span>, ], sc$t) %&gt;%<span class="st"> </span><span class="kw">split</span>(.$triangle_) %&gt;%<span class="st"> </span>purrr::<span class="kw">map</span>(function(x) <span class="kw">inner_join</span>(x, sc$tXv) %&gt;%<span class="st"> </span><span class="kw">inner_join</span>(sc$v)) </code></pre></div>
<pre><code>## Joining, by = "object_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<pre><code>## Joining, by = "triangle_"</code></pre>
<pre><code>## Joining, by = "vertex_"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">j &lt;-<span class="st"> </span><span class="kw">lapply</span>(l2, function(x) <span class="kw">polygon</span>(<span class="kw">cbind</span>(x$x_, x$y_), <span class="dt">col =</span> <span class="st">"firebrick"</span>))</code></pre></div>
<p><img src="sf-zoo2_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Much to still be done.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#base-graphics">Base graphics</a></li>
      <li><a href="#simple-features-for-r">Simple features for R</a></li>
      <li><a href="#spatial-legacy-sp-package">Spatial (legacy sp package)</a></li>
      <li><a href="#grammar-of-graphics">Grammar of graphics</a></li>
      <li><a href="#map-table">Map table</a></li>
      <li><a href="#planar-straight-line-graph">Planar straight line graph</a></li>
      <li><a href="#arc-node">Arc-node</a></li>
      <li><a href="#simplicial-complex">Simplicial complex</a></li>
      </ul></div>
      </div>

</div>


      <footer><p>Built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>. Styled with <a href="http://getbootstrap.com">Bootstrap 3</a>.</p>
      </footer></div>

  </body></html>
